<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>코딩스타트 - 코딩 과제 관리 시스템</title>
    <!-- Blockly 라이브러리 로드 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.0/blockly_compressed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.0/blocks_compressed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.0/javascript_compressed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.0/python_compressed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.0/msg/ko.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, #4285f4, #2a5298);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .header-nav {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: rgba(255,255,255,0.3);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .user-profile:hover {
            background: rgba(255,255,255,0.2);
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .main-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .task-list {
            width: 25%;
            background-color: #f0f0f0;
            padding: 1rem;
            overflow-y: auto;
            border-right: 1px solid #ddd;
        }

        .task-categories {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .category-tab {
            padding: 0.5rem 1rem;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .category-tab:hover {
            background-color: #e3f2fd;
        }

        .category-tab.active {
            background-color: #4285f4;
            color: white;
            border-color: #4285f4;
            transform: translateY(-2px);
        }

        .search-box {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 25px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #4285f4;
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        .task-item {
            padding: 1rem;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .task-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(66, 133, 244, 0.1), transparent);
            transition: left 0.5s;
        }

        .task-item:hover::before {
            left: 100%;
        }

        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .task-item.active {
            border: 2px solid #4285f4;
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
        }

        .task-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
            color: #1a73e8;
        }

        .task-meta {
            font-size: 0.8rem;
            color: #666;
        }

        .task-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-top: 0.5rem;
        }

        .status-pending {
            background-color: #ffeaa7;
            color: #2d3436;
        }

        .status-submitted {
            background-color: #81ecec;
            color: #2d3436;
        }

        .status-graded {
            background-color: #a29bfe;
            color: white;
        }

        .task-details {
            width: 75%;
            padding: 1rem;
            background-color: white;
            display: flex;
            flex-direction: column;
        }

        .task-header {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #4285f4;
        }

        .task-description {
            background: linear-gradient(135deg, #f9f9f9, #f0f0f0);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #4285f4;
        }

        .description-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #1a73e8;
        }

        .example-box {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 0.5rem;
            font-family: 'Consolas', monospace;
            white-space: pre;
            font-size: 0.9rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .editor-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            background-color: #f0f0f0;
            padding: 0.5rem;
            border-radius: 8px 8px 0 0;
        }

        .editor-tab {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .editor-tab:hover {
            background-color: #e3f2fd;
        }

        .editor-tab.active {
            background-color: #4285f4;
            color: white;
            transform: translateY(-2px);
        }

        .code-editor {
            border: 1px solid #ddd;
            min-height: 300px;
            background-color: #f9f9f9;
            margin-bottom: 1rem;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }

        .block-code-area {
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            padding: 1rem;
        }

        .code-block {
            padding: 0.75rem;
            border-radius: 8px;
            color: white;
            display: inline-block;
            margin-left: 20px;
            cursor: move;
            transition: all 0.3s ease;
        }

        .code-block:hover {
            transform: scale(1.05);
        }

        .code-block.yellow {
            background: linear-gradient(135deg, #ffc107, #ff8f00);
        }

        .code-block.blue {
            background: linear-gradient(135deg, #4285f4, #1976d2);
        }

        .code-block.red {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .code-block.green {
            background: linear-gradient(135deg, #4caf50, #388e3c);
        }

        #blocklyDiv {
            height: 100%;
            min-height: 300px;
            width: 100%;
        }

        .code-view {
            display: none;
            height: 300px;
            width: 100%;
            padding: 1rem;
            font-family: 'Consolas', monospace;
            white-space: pre;
            overflow: auto;
            background-color: #2d3748;
            color: #e2e8f0;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.75rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            border: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .btn-run {
            background: linear-gradient(135deg, #4caf50, #388e3c);
            color: white;
        }

        .btn-test {
            background: linear-gradient(135deg, #ff9800, #f57400);
            color: white;
        }

        .btn-submit {
            background: linear-gradient(135deg, #4285f4, #1976d2);
            color: white;
        }

        .code-panel {
            margin-top: 1rem;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            padding: 0.75rem;
            border-radius: 8px 8px 0 0;
        }

        .code-title {
            font-weight: bold;
            color: #1a73e8;
        }

        .language-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .language-button {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .language-button:hover {
            transform: translateY(-2px);
        }

        .active-language {
            background-color: #4285f4;
            color: white;
        }

        .inactive-language {
            background-color: white;
            border: 1px solid #ddd;
        }

        .code-content {
            height: 200px;
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            white-space: pre;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }

        .output-panel {
            margin-top: 1rem;
        }

        .output-header {
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            padding: 0.75rem;
            font-weight: bold;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #1a73e8;
        }

        .output-content {
            height: 150px;
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            white-space: pre;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }

        .test-case-panel {
            display: none;
            margin-top: 1rem;
        }

        .test-case-header {
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            padding: 0.75rem;
            font-weight: bold;
            border-radius: 8px 8px 0 0;
            color: #1a73e8;
        }

        .test-case-content {
            background-color: #f8f9fa;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 0 0 8px 8px;
        }

        .test-case-item {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            background: white;
            transition: all 0.3s ease;
        }

        .test-case-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .test-case-badge {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 1rem;
        }

        .badge-success {
            background-color: #4caf50;
        }

        .badge-error {
            background-color: #f44336;
        }

        .badge-pending {
            background-color: #9e9e9e;
        }

        .output-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            color: white;
            transition: all 0.3s ease;
        }

        .output-badge:hover {
            transform: scale(1.1);
        }

        .score-badge {
            background: linear-gradient(135deg, #4285f4, #1976d2);
        }

        .feedback-badge {
            background: linear-gradient(135deg, #ff9800, #f57400);
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 70%;
            max-width: 700px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #4285f4;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1a73e8;
        }

        .modal-close {
            cursor: pointer;
            font-size: 1.5rem;
            color: #666;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background-color: #f44336;
            color: white;
        }

        .modal-body {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .result-summary {
            margin-top: 1rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
            border-radius: 10px;
            text-align: center;
            border-left: 5px solid #4285f4;
        }

        .result-score {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .result-pass {
            color: #4caf50;
        }

        .result-fail {
            color: #f44336;
        }

        /* 로딩 관련 스타일 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .navigation-notification {
            position: fixed;
            top: 100px;
            right: 30px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            font-family: Arial, sans-serif;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .loading-skeleton {
            animation: skeleton-loading 1.5s infinite ease-in-out;
        }

        @keyframes skeleton-loading {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .no-assignment-selected {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
            text-align: center;
        }

        .no-assignment-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .header-nav {
                display: none;
            }
            
            .main-container {
                flex-direction: column;
            }
            
            .task-list, .task-details {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- 로딩 오버레이 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <header>
        <div class="logo" id="logoTitle">🚀 코딩스타트: 코딩 과제</div>
        
        <div class="header-nav">
            <a href="#" class="nav-link" id="dashboardLink">대시보드</a>
            <a href="#" class="nav-link" id="blockCodingLink">블록 코딩</a>
            <a href="#" class="nav-link" id="algorithmLink">알고리즘</a>
            <a href="#" class="nav-link active" id="assignmentsLink">과제 관리</a>
            <a href="#" class="nav-link" id="progressLink">학습 현황</a>
        </div>

        <div class="user-profile" id="userProfile">
            <span id="userName">사용자</span>
            <div class="avatar" id="userAvatar">U</div>
        </div>
    </header>

    <div class="main-container">
        <!-- 좌측 과제 목록 -->
        <div class="task-list">
            <h3>과제 목록</h3>

            <!-- 과제 카테고리 탭 -->
            <div class="task-categories">
                <div class="category-tab active" data-category="all">전체</div>
                <div class="category-tab" data-category="pending">미완료</div>
                <div class="category-tab" data-category="submitted">제출완료</div>
            </div>

            <!-- 과제 검색 -->
            <input type="text" class="search-box" placeholder="과제 검색..." id="searchBox">

            <!-- 과제 목록 항목들 -->
            <div class="task-items" id="taskItems">
                <!-- 로딩 스켈레톤 -->
                <div class="loading-skeleton" id="loadingSkeleton">
                    <div class="task-item" style="background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite;">
                        <div style="height: 20px; background: rgba(255,255,255,0.8); margin-bottom: 8px; border-radius: 4px;"></div>
                        <div style="height: 14px; background: rgba(255,255,255,0.8); margin-bottom: 4px; border-radius: 4px; width: 70%;"></div>
                    </div>
                    <div class="task-item" style="background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite;">
                        <div style="height: 20px; background: rgba(255,255,255,0.8); margin-bottom: 8px; border-radius: 4px;"></div>
                        <div style="height: 14px; background: rgba(255,255,255,0.8); margin-bottom: 4px; border-radius: 4px; width: 70%;"></div>
                    </div>
                </div>

                <!-- 빈 상태 메시지 -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-state-icon">📝</div>
                    <h3>과제가 없습니다</h3>
                    <p>등록된 과제가 없습니다.</p>
                </div>
            </div>
        </div>

        <!-- 우측 과제 상세 패널 -->
        <div class="task-details" id="taskDetails">
            <!-- 과제가 선택되지 않은 상태 -->
            <div class="no-assignment-selected" id="noAssignmentSelected">
                <div class="no-assignment-icon">📚</div>
                <h2>과제를 선택해주세요</h2>
                <p>왼쪽 목록에서 과제를 선택하면 상세 내용을 볼 수 있습니다.</p>
            </div>

            <!-- 과제 상세 내용 (처음에는 숨겨짐) -->
            <div id="assignmentContent" style="display: none;">
                <!-- 과제 제목 및 정보 -->
                <div class="task-header">
                    <h2 id="currentTaskTitle">과제 제목</h2>
                    <div class="task-meta" id="currentTaskMeta">과제 정보</div>
                </div>

                <!-- 과제 설명 영역 -->
                <div class="task-description">
                    <div class="description-title">문제 설명</div>
                    <p id="taskDescription">과제 설명이 여기에 표시됩니다.</p>
                    <div id="problemStatement" style="margin-top: 1rem;"></div>

                    <div class="description-title" style="margin-top: 1rem;">입출력 예시</div>
                    <div class="example-box" id="taskExample">예시가 여기에 표시됩니다.</div>
                </div>

                <!-- 코드 에디터 영역 -->
                <div class="editor-tabs">
                    <div class="editor-tab active" data-editor="block">블록</div>
                    <div class="editor-tab" data-editor="code">코드</div>
                </div>

                <div class="code-editor">
                    <!-- 블록 코드 영역 -->
                    <div id="blocklyDiv"></div>
                    <div id="codeView" class="code-view"></div>
                </div>

                <!-- 코드 표시 영역 -->
                <div class="code-panel">
                    <div class="code-header">
                        <div class="code-title">실제 코드</div>
                        <div class="language-buttons">
                            <div class="language-button active-language" id="pythonButton">Python</div>
                            <div class="language-button inactive-language" id="javascriptButton">JavaScript</div>
                        </div>
                    </div>
                    <div class="code-content" id="codeContent"></div>
                </div>

                <!-- 출력 영역 -->
                <div class="output-panel">
                    <div class="output-header">
                        <span>실행 결과</span>
                        <div>
                            <span class="output-badge score-badge" id="scoreDisplay" style="display: none;">점수: 0/100</span>
                            <span class="output-badge feedback-badge" id="feedbackButton" style="display: none;">피드백 보기</span>
                        </div>
                    </div>
                    <div class="output-content" id="outputContent"></div>
                </div>

                <!-- 테스트 케이스 패널 -->
                <div class="test-case-panel" id="testCasePanel">
                    <div class="test-case-header">테스트 케이스 결과</div>
                    <div class="test-case-content" id="testCaseContent">
                        <!-- 여기에 테스트 케이스 결과가 표시됩니다 -->
                    </div>
                </div>

                <!-- 실행 및 제출 버튼 -->
                <div class="action-buttons">
                    <button class="btn btn-run" id="runButton">실행</button>
                    <button class="btn btn-test" id="testButton">테스트</button>
                    <button class="btn btn-submit" id="submitButton">제출</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 피드백 모달 -->
    <div class="modal" id="feedbackModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">코드 피드백</div>
                <span class="modal-close" id="closeModal">&times;</span>
            </div>
            <div class="modal-body" id="feedbackContent">
                <!-- 여기에 피드백 내용이 표시됩니다 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-submit" id="confirmModal">확인</button>
            </div>
        </div>
    </div>

    <!-- XML 정의 (Blockly 툴박스) -->
    <xml id="toolbox" style="display: none">
        <category name="제어" colour="#ffc107">
            <block type="controls_if"></block>
            <block type="controls_repeat_ext">
                <value name="TIMES">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
            </block>
            <block type="controls_for">
                <value name="FROM">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="TO">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
                <value name="BY">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="controls_forEach"></block>
        </category>
        <category name="입출력" colour="#4285f4">
            <block type="text_print">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_prompt_ext">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">숫자를 입력하세요</field>
                    </shadow>
                </value>
            </block>
        </category>
        <category name="논리" colour="#34a853">
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_boolean"></block>
        </category>
        <category name="수학" colour="#ea4335">
            <block type="math_number">
                <field name="NUM">0</field>
            </block>
            <block type="math_arithmetic">
                <value name="A">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="B">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
        </category>
        <category name="텍스트" colour="#9c27b0">
            <block type="text">
                <field name="TEXT"></field>
            </block>
            <block type="text_join"></block>
            <block type="text_append">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT"></field>
                    </shadow>
                </value>
            </block>
        </category>
        <category name="변수" colour="#ff5722" custom="VARIABLE"></category>
        <category name="함수" colour="#795548" custom="PROCEDURE"></category>
    </xml>

    <script>
        // 통합 네비게이션 시스템
        class NavigationManager {
            constructor() {
                this.currentUser = null;
                this.routes = {
                    'dashboard': '/dashboard',
                    'block-coding': '/block-coding', 
                    'algorithm': '/algorithm',
                    'assignments': '/assignments',
                    'progress': '/progress',
                    'teacher-dashboard': '/teacher-dashboard',
                    'create-assignment': '/create-assignment',
                    'review-submissions': '/review-submissions',
                    'student-analytics': '/student-analytics',
                    'student-management': '/student-management',
                    'login': '/login'
                };
                
                this.init();
            }

            init() {
                this.loadUserInfo();
                this.setupEventListeners();
                this.updateNavigationUI();
            }

            loadUserInfo() {
                const token = localStorage.getItem('authToken');
                const userJSON = localStorage.getItem('user');

                if (!token || !userJSON) {
                    this.redirectToLogin();
                    return false;
                }

                try {
                    this.currentUser = JSON.parse(userJSON);
                    return true;
                } catch (error) {
                    console.error('사용자 정보 파싱 오류:', error);
                    this.clearAuthAndRedirect();
                    return false;
                }
            }

            setupEventListeners() {
                // 로고 클릭 이벤트
                const logoTitle = document.getElementById('logoTitle');
                if (logoTitle) {
                    logoTitle.addEventListener('click', () => {
                        this.navigateToDashboard();
                    });
                }

                // 네비게이션 링크들
                const navLinks = {
                    'dashboardLink': () => this.navigateToDashboard(),
                    'blockCodingLink': () => this.navigateTo('block-coding'),
                    'algorithmLink': () => this.navigateTo('algorithm'),
                    'assignmentsLink': () => {}, // 현재 페이지
                    'progressLink': () => this.navigateTo('progress')
                };

                Object.keys(navLinks).forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('click', (e) => {
                            e.preventDefault();
                            navLinks[id]();
                        });
                    }
                });

                // 사용자 프로필 클릭 이벤트
                const userProfile = document.getElementById('userProfile');
                if (userProfile) {
                    userProfile.addEventListener('click', () => {
                        this.handleLogout();
                    });
                }
            }

            updateNavigationUI() {
                if (!this.currentUser) return;

                // 사용자 이름 업데이트
                const userName = document.getElementById('userName');
                if (userName) {
                    userName.textContent = this.currentUser.name || '사용자';
                }

                // 사용자 아바타 업데이트
                const userAvatar = document.getElementById('userAvatar');
                if (userAvatar) {
                    const initial = (this.currentUser.name || 'U').charAt(0).toUpperCase();
                    userAvatar.textContent = initial;
                }
            }

            navigateToDashboard() {
                if (this.currentUser.role === 'professor' || this.currentUser.role === 'admin') {
                    this.navigateTo('teacher-dashboard');
                } else {
                    this.navigateTo('dashboard');
                }
            }

            navigateTo(routeName) {
                if (this.routes[routeName]) {
                    this.showLoading();
                    
                    setTimeout(() => {
                        window.location.href = this.routes[routeName];
                    }, 300);
                } else {
                    console.error(`Route not found: ${routeName}`);
                }
            }

            redirectToLogin() {
                this.showNotification('로그인이 필요합니다.', 'error');
                setTimeout(() => {
                    window.location.href = this.routes.login;
                }, 1500);
            }

            clearAuthAndRedirect() {
                localStorage.clear();
                this.redirectToLogin();
            }

            handleLogout() {
                if (confirm('로그아웃 하시겠습니까?')) {
                    this.showLoading();
                    
                    const token = localStorage.getItem('authToken');
                    
                    fetch('/api/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + token,
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(() => {
                        localStorage.clear();
                        this.showNotification('로그아웃되었습니다.');
                        setTimeout(() => {
                            window.location.href = this.routes.login;
                        }, 1000);
                    })
                    .catch((error) => {
                        console.error('로그아웃 오류:', error);
                        localStorage.clear();
                        window.location.href = this.routes.login;
                    })
                    .finally(() => {
                        this.hideLoading();
                    });
                }
            }

            showLoading() {
                let loadingOverlay = document.getElementById('loadingOverlay');
                if (loadingOverlay) {
                    loadingOverlay.classList.add('active');
                }
            }

            hideLoading() {
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (loadingOverlay) {
                    loadingOverlay.classList.remove('active');
                }
            }

            showNotification(message, type = 'success') {
                const existingNotification = document.getElementById('navigationNotification');
                if (existingNotification) {
                    existingNotification.remove();
                }

                const notification = document.createElement('div');
                notification.id = 'navigationNotification';
                notification.className = 'navigation-notification';
                notification.textContent = message;

                const backgroundColor = type === 'error' 
                    ? 'linear-gradient(135deg, #f44336, #d32f2f)' 
                    : 'linear-gradient(135deg, #4CAF50, #45a049)';

                notification.style.background = backgroundColor;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);

                setTimeout(() => {
                    notification.style.transform = 'translateX(400px)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case '1':
                                e.preventDefault();
                                this.navigateToDashboard();
                                break;
                            case '2':
                                e.preventDefault();
                                this.navigateTo('block-coding');
                                break;
                            case '3':
                                e.preventDefault();
                                this.navigateTo('algorithm');
                                break;
                            case '4':
                                e.preventDefault();
                                // 현재 페이지이므로 아무것도 하지 않음
                                break;
                            case '5':
                                e.preventDefault();
                                this.navigateTo('progress');
                                break;
                        }
                    }
                });
            }
        }

        // 과제 관리 시스템
        class AssignmentManager {
            constructor() {
                this.assignments = [];
                this.currentAssignment = null;
                this.currentSubmission = null;
                this.currentEditorMode = 'block';
                this.testResults = [];
                this.workspace = null;
                
                this.init();
            }

            async init() {
                try {
                    await this.loadAssignments();
                    this.initBlockly();
                    this.setupEventListeners();
                } catch (error) {
                    console.error('초기화 오류:', error);
                    navigationManager.showNotification('초기화 중 오류가 발생했습니다.', 'error');
                }
            }

            async loadAssignments() {
                try {
                    const token = localStorage.getItem('authToken');
                    if (!token) {
                        throw new Error('인증 토큰이 없습니다.');
                    }
                    
                    console.log('Loading assignments...');
                    
                    const response = await fetch('/api/assignments', {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + token,
                            'Content-Type': 'application/json'
                        }
                    });

                    console.log('Assignments response status:', response.status);

                    if (!response.ok) {
                        if (response.status === 401) {
                            // 토큰 만료
                            localStorage.clear();
                            navigationManager.redirectToLogin();
                            return;
                        }
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const result = await response.json();
                    console.log('Assignments result:', result);
                    
                    if (result.success) {
                        this.assignments = result.assignments || [];
                        console.log('Loaded assignments:', this.assignments.length);
                        this.renderAssignmentList();
                    } else {
                        throw new Error(result.message || '과제 목록을 불러올 수 없습니다.');
                    }
                } catch (error) {
                    console.error('과제 로드 오류:', error);
                    this.showEmptyState();
                    navigationManager.showNotification('과제 목록을 불러오는데 실패했습니다: ' + error.message, 'error');
                }
            }

            renderAssignmentList() {
                const taskItems = document.getElementById('taskItems');
                const loadingSkeleton = document.getElementById('loadingSkeleton');
                const emptyState = document.getElementById('emptyState');

                // 로딩 스켈레톤 숨기기
                if (loadingSkeleton) {
                    loadingSkeleton.style.display = 'none';
                }

                if (this.assignments.length === 0) {
                    this.showEmptyState();
                    return;
                }

                // 빈 상태 숨기기
                if (emptyState) {
                    emptyState.style.display = 'none';
                }

                // 과제 목록 생성
                taskItems.innerHTML = '';
                
                this.assignments.forEach((assignment, index) => {
                    const taskItem = this.createAssignmentItem(assignment, index);
                    taskItems.appendChild(taskItem);
                });
            }

            createAssignmentItem(assignment, index) {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.setAttribute('data-assignment-id', assignment.assignment_id);

                // 제출 상태 확인
                let statusClass = 'status-pending';
                let statusText = '미완료';
                
                if (assignment.submission) {
                    if (assignment.submission.score !== null && assignment.submission.graded_at) {
                        statusClass = 'status-graded';
                        statusText = `채점완료 (${assignment.submission.score}점)`;
                    } else {
                        statusClass = 'status-submitted';
                        statusText = '제출완료';
                    }
                }

                // 마감일 계산
                let dueDateText = '마감일 없음';
                if (assignment.due_date) {
                    const dueDate = new Date(assignment.due_date);
                    const now = new Date();
                    const diffTime = dueDate - now;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays < 0) {
                        dueDateText = '마감됨';
                    } else if (diffDays === 0) {
                        dueDateText = '오늘 마감';
                    } else {
                        dueDateText = `${diffDays}일 후`;
                    }
                }

                // 난이도 텍스트 변환
                const difficultyMap = {
                    'easy': '초급',
                    'medium': '중급',
                    'hard': '고급'
                };
                const difficultyText = difficultyMap[assignment.difficulty_level] || assignment.difficulty_level;

                taskItem.innerHTML = `
                    <div class="task-title">${assignment.title}</div>
                    <div class="task-meta">난이도: ${difficultyText} | 마감: ${dueDateText}</div>
                    <div class="task-meta">출제자: ${assignment.creator_name}</div>
                    <div class="task-status ${statusClass}">${statusText}</div>
                `;

                // 클릭 이벤트 추가
                taskItem.addEventListener('click', () => {
                    this.selectAssignment(assignment);
                    
                    // 활성화 상태 업데이트
                    document.querySelectorAll('.task-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    taskItem.classList.add('active');
                });

                return taskItem;
            }

            showEmptyState() {
                const taskItems = document.getElementById('taskItems');
                const loadingSkeleton = document.getElementById('loadingSkeleton');
                const emptyState = document.getElementById('emptyState');

                if (loadingSkeleton) {
                    loadingSkeleton.style.display = 'none';
                }
                
                taskItems.innerHTML = '';
                
                if (emptyState) {
                    emptyState.style.display = 'block';
                }
            }

            async selectAssignment(assignment) {
                try {
                    this.currentAssignment = assignment;
                    this.currentSubmission = assignment.submission || null;

                    // 과제 상세 정보 로드
                    await this.loadAssignmentDetails(assignment.assignment_id);
                    
                    // UI 업데이트
                    this.showAssignmentDetails();
                    
                } catch (error) {
                    console.error('과제 선택 오류:', error);
                    navigationManager.showNotification('과제 정보를 불러오는데 실패했습니다.', 'error');
                }
            }

            async loadAssignmentDetails(assignmentId) {
                try {
                    const token = localStorage.getItem('authToken');
                    
                    const response = await fetch(`/api/assignments/${assignmentId}`, {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + token,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const result = await response.json();
                    
                    if (result.success) {
                        this.currentAssignment = { ...this.currentAssignment, ...result.assignment };
                        this.currentSubmission = result.assignment.submission || null;
                    } else {
                        throw new Error(result.message || '과제 상세 정보를 불러올 수 없습니다.');
                    }
                } catch (error) {
                    console.error('과제 상세 로드 오류:', error);
                    throw error;
                }
            }

            showAssignmentDetails() {
                const noAssignmentSelected = document.getElementById('noAssignmentSelected');
                const assignmentContent = document.getElementById('assignmentContent');

                // 선택 안내 숨기기
                if (noAssignmentSelected) {
                    noAssignmentSelected.style.display = 'none';
                }

                // 과제 내용 표시
                if (assignmentContent) {
                    assignmentContent.style.display = 'block';
                }

                // 과제 정보 업데이트
                this.updateAssignmentInfo();
                
                // 결과 패널 초기화
                this.resetResultPanels();
                
                // 기존 제출물이 있으면 점수 표시
                if (this.currentSubmission && this.currentSubmission.score !== null) {
                    this.showSubmissionResult();
                }
            }

            updateAssignmentInfo() {
                // 제목
                const titleEl = document.getElementById('currentTaskTitle');
                if (titleEl) {
                    titleEl.textContent = this.currentAssignment.title || '과제 제목';
                }

                // 메타 정보
                const metaEl = document.getElementById('currentTaskMeta');
                if (metaEl) {
                    const difficultyMap = {
                        'easy': '초급',
                        'medium': '중급',
                        'hard': '고급'
                    };
                    const difficulty = difficultyMap[this.currentAssignment.difficulty_level] || this.currentAssignment.difficulty_level;
                    
                    let dueDateStr = '마감일 없음';
                    if (this.currentAssignment.due_date) {
                        const dueDate = new Date(this.currentAssignment.due_date);
                        dueDateStr = dueDate.toLocaleDateString('ko-KR', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }

                    metaEl.textContent = `난이도: ${difficulty} | 출제자: ${this.currentAssignment.creator_name} | 마감: ${dueDateStr}`;
                }

                // 설명
                const descEl = document.getElementById('taskDescription');
                if (descEl) {
                    descEl.textContent = this.currentAssignment.description || '과제 설명이 없습니다.';
                }

                // 문제 명세
                const problemEl = document.getElementById('problemStatement');
                if (problemEl) {
                    problemEl.innerHTML = `<div class="description-title">문제 명세</div><p>${this.currentAssignment.problem_statement || '문제 명세가 없습니다.'}</p>`;
                }

                // 예시 (실제 테스트 케이스가 있다면 첫 번째 것을 예시로 사용)
                const exampleEl = document.getElementById('taskExample');
                if (exampleEl) {
                    // 기본 예시 텍스트
                    exampleEl.textContent = '입출력 예시가 제공되지 않았습니다.';
                }
            }

            resetResultPanels() {
                // 출력 영역 초기화
                const outputContent = document.getElementById('outputContent');
                if (outputContent) {
                    outputContent.textContent = '';
                }

                // 테스트 케이스 패널 숨기기
                const testCasePanel = document.getElementById('testCasePanel');
                if (testCasePanel) {
                    testCasePanel.style.display = 'none';
                }

                // 점수 및 피드백 숨기기
                const scoreDisplay = document.getElementById('scoreDisplay');
                const feedbackButton = document.getElementById('feedbackButton');
                if (scoreDisplay) scoreDisplay.style.display = 'none';
                if (feedbackButton) feedbackButton.style.display = 'none';
            }

            showSubmissionResult() {
                if (!this.currentSubmission) return;

                const scoreDisplay = document.getElementById('scoreDisplay');
                const feedbackButton = document.getElementById('feedbackButton');

                if (this.currentSubmission.score !== null) {
                    if (scoreDisplay) {
                        scoreDisplay.textContent = `점수: ${this.currentSubmission.score}/100`;
                        scoreDisplay.style.display = 'inline-block';
                    }

                    if (this.currentSubmission.feedback && feedbackButton) {
                        feedbackButton.style.display = 'inline-block';
                    }
                }
            }

            // Blockly 초기화
            initBlockly() {
                this.workspace = Blockly.inject('blocklyDiv', {
                    toolbox: document.getElementById('toolbox'),
                    grid: {
                        spacing: 20,
                        length: 3,
                        colour: '#ccc',
                        snap: true
                    },
                    zoom: {
                        controls: true,
                        wheel: true,
                        startScale: 1.0,
                        maxScale: 3,
                        minScale: 0.3,
                        scaleSpeed: 1.2
                    },
                    trashcan: true
                });

                // 코드 변경 이벤트 리스너
                this.workspace.addChangeListener(() => {
                    this.updateCode();
                });
            }

            setupEventListeners() {
                // 에디터 탭 전환
                document.querySelectorAll('.editor-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const mode = e.target.getAttribute('data-editor');
                        this.switchEditorMode(mode);
                        
                        // 탭 활성화 상태 업데이트
                        document.querySelectorAll('.editor-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                    });
                });

                // 언어 버튼
                document.querySelectorAll('.language-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        document.querySelectorAll('.language-button').forEach(b => {
                            b.classList.remove('active-language');
                            b.classList.add('inactive-language');
                        });
                        e.target.classList.remove('inactive-language');
                        e.target.classList.add('active-language');
                        this.updateCode();
                    });
                });

                // 실행 버튼
                const runButton = document.getElementById('runButton');
                if (runButton) {
                    runButton.addEventListener('click', () => {
                        this.runCode();
                    });
                }

                // 테스트 버튼
                const testButton = document.getElementById('testButton');
                if (testButton) {
                    testButton.addEventListener('click', () => {
                        this.runTests();
                    });
                }

                // 제출 버튼
                const submitButton = document.getElementById('submitButton');
                if (submitButton) {
                    submitButton.addEventListener('click', () => {
                        this.submitAssignment();
                    });
                }

                // 검색 기능
                const searchBox = document.getElementById('searchBox');
                if (searchBox) {
                    searchBox.addEventListener('input', (e) => {
                        this.searchAssignments(e.target.value);
                    });
                }

                // 카테고리 탭
                document.querySelectorAll('.category-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const category = e.target.getAttribute('data-category');
                        this.filterAssignments(category);
                        
                        // 탭 활성화 상태 업데이트
                        document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                    });
                });

                // 모달 이벤트
                this.setupModalEvents();
            }

            setupModalEvents() {
                const modal = document.getElementById('feedbackModal');
                const closeModal = document.getElementById('closeModal');
                const confirmModal = document.getElementById('confirmModal');
                const feedbackButton = document.getElementById('feedbackButton');

                if (feedbackButton) {
                    feedbackButton.addEventListener('click', () => {
                        this.showFeedbackModal();
                    });
                }

                if (closeModal) {
                    closeModal.addEventListener('click', () => {
                        modal.style.display = 'none';
                    });
                }

                if (confirmModal) {
                    confirmModal.addEventListener('click', () => {
                        modal.style.display = 'none';
                    });
                }

                window.addEventListener('click', (event) => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            }

            switchEditorMode(mode) {
                const blocklyDiv = document.getElementById('blocklyDiv');
                const codeView = document.getElementById('codeView');

                if (mode === 'block') {
                    blocklyDiv.style.display = 'block';
                    codeView.style.display = 'none';
                    this.currentEditorMode = 'block';
                } else if (mode === 'code') {
                    blocklyDiv.style.display = 'none';
                    codeView.style.display = 'block';
                    this.currentEditorMode = 'code';
                    
                    // 코드 뷰 업데이트
                    const code = this.getGeneratedCode();
                    codeView.textContent = code;
                }
            }

            getGeneratedCode() {
                if (!this.workspace) return '';

                const pythonButton = document.getElementById('pythonButton');
                let code = '';

                if (pythonButton && pythonButton.classList.contains('active-language')) {
                    // Python 코드 생성
                    try {
                        code = Blockly.JavaScript.workspaceToCode(this.workspace);
                    } catch (e) {
                        code = '// 코드 생성 중 오류가 발생했습니다.\n// ' + e.message;
                    }
                }

                return code;
            }

            updateCode() {
                const code = this.getGeneratedCode();
                const codeContent = document.getElementById('codeContent');
                if (codeContent) {
                    codeContent.textContent = code;
                }

                // 코드 뷰 모드인 경우 코드 뷰도 업데이트
                if (this.currentEditorMode === 'code') {
                    const codeView = document.getElementById('codeView');
                    if (codeView) {
                        codeView.textContent = code;
                    }
                }
            }

            runCode() {
                if (!this.workspace) return;

                const outputContent = document.getElementById('outputContent');
                if (!outputContent) return;

                // 출력 영역 초기화
                outputContent.textContent = '';

                // 점수 및 피드백 숨기기
                const scoreDisplay = document.getElementById('scoreDisplay');
                const feedbackButton = document.getElementById('feedbackButton');
                const testCasePanel = document.getElementById('testCasePanel');
                
                if (scoreDisplay) scoreDisplay.style.display = 'none';
                if (feedbackButton) feedbackButton.style.display = 'none';
                if (testCasePanel) testCasePanel.style.display = 'none';

                try {
                    // 현재 선택된 언어 확인
                    const pythonButton = document.getElementById('pythonButton');
                    const isPython = pythonButton && pythonButton.classList.contains('active-language');
                    
                    let code;
                    if (isPython) {
                        // Python 코드 표시
                        const pythonCode = Blockly.Python.workspaceToCode(this.workspace);
                        outputContent.textContent += '※ Python 코드:\n\n' + pythonCode + '\n\n';
                        outputContent.textContent += '※ 실행 결과 (JavaScript로 실행):\n\n';
                        
                        // JavaScript 코드로 실행
                        code = Blockly.JavaScript.workspaceToCode(this.workspace);
                    } else {
                        // JavaScript 코드
                        code = Blockly.JavaScript.workspaceToCode(this.workspace);
                    }

                    // 콘솔 출력을 캡처하기 위해 console.log 임시 재정의
                    const originalConsoleLog = console.log;
                    console.log = function () {
                        const args = Array.from(arguments);
                        outputContent.textContent += args.join(' ') + '\n';
                        originalConsoleLog.apply(console, arguments);
                    };

                    // 사용자 입력을 시뮬레이션하기 위한 prompt 재정의
                    const originalPrompt = window.prompt;
                    window.prompt = function (text) {
                        const result = originalPrompt(text);
                        outputContent.textContent += `입력: ${result}\n`;
                        return result;
                    };

                    // JavaScript 코드 실행
                    new Function(code)();

                    // 원래 함수 복원
                    console.log = originalConsoleLog;
                    window.prompt = originalPrompt;

                    navigationManager.showNotification('코드가 실행되었습니다!');
                } catch (e) {
                    // 오류가 발생한 경우
                    outputContent.textContent += '실행 중 오류 발생: ' + e.message;
                    console.error('Code execution error:', e);
                    navigationManager.showNotification('코드 실행 중 오류가 발생했습니다.', 'error');
                }
            }

            runTests() {
                if (!this.currentAssignment || !this.workspace) {
                    navigationManager.showNotification('과제가 선택되지 않았습니다.', 'error');
                    return;
                }

                // 실제 테스트 케이스는 서버에서 가져와야 하므로 기본 테스트만 실행
                const outputContent = document.getElementById('outputContent');
                const testCaseContent = document.getElementById('testCaseContent');
                const testCasePanel = document.getElementById('testCasePanel');
                
                if (!outputContent || !testCaseContent || !testCasePanel) return;

                // 언어에 관계없이 항상 JavaScript 코드를 얻어서 실행
                const code = Blockly.JavaScript.workspaceToCode(this.workspace);

                // 출력 영역 초기화
                outputContent.textContent = '';
                testCaseContent.innerHTML = '';

                // Python 모드인 경우 Python 코드도 표시
                const pythonButton = document.getElementById('pythonButton');
                const isPython = pythonButton && pythonButton.classList.contains('active-language');
                if (isPython) {
                    const pythonCode = Blockly.Python.workspaceToCode(this.workspace);
                    outputContent.textContent += '※ Python 코드:\n\n' + pythonCode + '\n\n';
                    outputContent.textContent += '※ 테스트 결과 (JavaScript로 실행):\n\n';
                }

                // 테스트 패널 표시
                testCasePanel.style.display = 'block';

                // 기본 테스트 케이스 (실제로는 서버에서 가져와야 함)
                const defaultTestCases = [
                    { input: '3', expectedOutput: '기본 테스트 케이스' },
                    { input: '5', expectedOutput: '확장 테스트 케이스' }
                ];

                let passedCount = 0;
                this.testResults = [];

                for (let i = 0; i < defaultTestCases.length; i++) {
                    const testCase = defaultTestCases[i];

                    try {
                        // 테스트 케이스 항목 생성
                        const testItem = document.createElement('div');
                        testItem.className = 'test-case-item';

                        // 콘솔 출력 캡처
                        const originalConsoleLog = console.log;
                        let outputLines = [];
                        console.log = function () {
                            const args = Array.from(arguments);
                            outputLines.push(args.join(' '));
                            originalConsoleLog.apply(console, arguments);
                        };

                        // 프롬프트 대체 (테스트 케이스의 입력 사용)
                        const originalPrompt = window.prompt;
                        window.prompt = function () {
                            return testCase.input;
                        };

                        // 코드 실행
                        new Function(code)();

                        // 원래 함수 복원
                        console.log = originalConsoleLog;
                        window.prompt = originalPrompt;

                        // 출력 비교 (기본적으로 통과로 처리)
                        const output = outputLines.join('\n');
                        const isPassed = true; // 실제로는 서버 측 테스트 케이스와 비교해야 함

                        // 결과 저장
                        this.testResults.push({
                            input: testCase.input,
                            output: output,
                            expected: testCase.expectedOutput,
                            passed: isPassed
                        });

                        // 통과 여부에 따라 UI 업데이트
                        const badgeDiv = document.createElement('div');
                        badgeDiv.className = 'test-case-badge ' + (isPassed ? 'badge-success' : 'badge-error');

                        const textDiv = document.createElement('div');
                        textDiv.textContent = `테스트 케이스 ${i + 1}: ${testCase.input} => ${isPassed ? '통과' : '실패'}`;

                        testItem.appendChild(badgeDiv);
                        testItem.appendChild(textDiv);
                        testCaseContent.appendChild(testItem);

                        if (isPassed) {
                            passedCount++;
                        }
                    } catch (e) {
                        // 오류 발생 시
                        const testItem = document.createElement('div');
                        testItem.className = 'test-case-item';

                        const badgeDiv = document.createElement('div');
                        badgeDiv.className = 'test-case-badge badge-error';

                        const textDiv = document.createElement('div');
                        textDiv.textContent = `테스트 케이스 ${i + 1}: 오류 발생 - ${e.message}`;

                        testItem.appendChild(badgeDiv);
                        testItem.appendChild(textDiv);
                        testCaseContent.appendChild(testItem);

                        // 결과 저장
                        this.testResults.push({
                            input: testCase.input,
                            output: '오류: ' + e.message,
                            expected: testCase.expectedOutput,
                            passed: false
                        });
                    }
                }

                // 점수 계산 및 표시
                const score = Math.round((passedCount / defaultTestCases.length) * 100);
                const scoreDisplay = document.getElementById('scoreDisplay');
                const feedbackButton = document.getElementById('feedbackButton');
                
                if (scoreDisplay) {
                    scoreDisplay.textContent = `점수: ${score}/100`;
                    scoreDisplay.style.display = 'inline-block';
                }

                // 피드백 버튼 표시
                if (feedbackButton) {
                    feedbackButton.style.display = 'inline-block';
                }

                // 결과 요약 표시
                outputContent.textContent += `테스트 결과: ${passedCount}/${defaultTestCases.length} 통과 (${score}점)\n\n`;
                outputContent.textContent += '※ 자세한 결과는 테스트 케이스 패널을 확인하세요.';

                navigationManager.showNotification('테스트가 실행되었습니다!');
            }

            async submitAssignment() {
                if (!this.currentAssignment || !this.workspace) {
                    navigationManager.showNotification('과제가 선택되지 않았습니다.', 'error');
                    return;
                }

                // 블록이 있는지 확인
                const topBlocks = this.workspace.getTopBlocks();
                if (topBlocks.length === 0) {
                    navigationManager.showNotification('제출할 블록이 없습니다. 먼저 코드를 작성해주세요.', 'error');
                    return;
                }

                // 사용자에게 제출 확인
                if (!confirm('과제를 제출하시겠습니까? 제출 후에도 수정하여 재제출할 수 있습니다.')) {
                    return;
                }

                try {
                    navigationManager.showLoading();

                    // 코드 데이터 준비
                    let blockXml = '';
                    let jsCode = '';
                    let pythonCode = '';

                    try {
                        // Blockly XML 직렬화
                        const blockData = Blockly.Xml.workspaceToDom(this.workspace);
                        blockXml = Blockly.Xml.domToText(blockData);
                        
                        // JavaScript 코드 생성
                        jsCode = Blockly.JavaScript.workspaceToCode(this.workspace) || '';
                        
                        // Python 코드 생성  
                        pythonCode = Blockly.Python.workspaceToCode(this.workspace) || '';
                        
                        console.log('Generated codes:', { blockXml, jsCode, pythonCode });
                        
                    } catch (codeGenError) {
                        console.error('코드 생성 오류:', codeGenError);
                        throw new Error('코드 생성 중 오류가 발생했습니다: ' + codeGenError.message);
                    }

                    // 제출 데이터 구성
                    const submissionData = {
                        submission_data: JSON.stringify({
                            blocks: blockXml,
                            javascript_code: jsCode,
                            python_code: pythonCode,
                            block_count: topBlocks.length,
                            timestamp: new Date().toISOString()
                        })
                    };

                    console.log('Submitting assignment:', this.currentAssignment.assignment_id, submissionData);

                    const token = localStorage.getItem('authToken');
                    if (!token) {
                        throw new Error('인증 토큰이 없습니다. 다시 로그인해주세요.');
                    }

                    const response = await fetch(`/api/assignments/${this.currentAssignment.assignment_id}/submit`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + token
                        },
                        body: JSON.stringify(submissionData)
                    });

                    console.log('Response status:', response.status);
                    console.log('Response headers:', response.headers);

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Response error:', errorText);
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }

                    const result = await response.json();
                    console.log('Submit result:', result);

                    if (result.success) {
                        navigationManager.showNotification('과제가 성공적으로 제출되었습니다!');
                        
                        // 제출 상태 업데이트
                        this.currentSubmission = {
                            submission_id: result.submission_id || Date.now(), // 임시 ID
                            submitted_at: new Date().toISOString(),
                            score: null,
                            graded_at: null,
                            feedback: null
                        };

                        // 현재 과제 객체 업데이트
                        this.currentAssignment.submission = this.currentSubmission;
                        
                        // UI 즉시 업데이트
                        const currentItem = document.querySelector(`[data-assignment-id="${this.currentAssignment.assignment_id}"]`);
                        if (currentItem) {
                            const statusEl = currentItem.querySelector('.task-status');
                            if (statusEl) {
                                statusEl.className = 'task-status status-submitted';
                                statusEl.textContent = '제출완료';
                            }
                        }

                        // 과제 목록 새로고침 (비동기로 백그라운드에서)
                        setTimeout(() => {
                            this.loadAssignments().catch(console.error);
                        }, 1000);
                        
                    } else {
                        throw new Error(result.message || '제출에 실패했습니다.');
                    }
                } catch (error) {
                    console.error('제출 오류:', error);
                    
                    // 구체적인 오류 메시지 제공
                    let errorMessage = '제출 중 오류가 발생했습니다.';
                    
                    if (error.message.includes('HTTP 401')) {
                        errorMessage = '로그인이 만료되었습니다. 다시 로그인해주세요.';
                    } else if (error.message.includes('HTTP 403')) {
                        errorMessage = '제출 권한이 없습니다.';
                    } else if (error.message.includes('HTTP 404')) {
                        errorMessage = '과제를 찾을 수 없습니다.';
                    } else if (error.message.includes('HTTP 400')) {
                        errorMessage = '제출 데이터가 올바르지 않습니다.';
                    } else if (error.message) {
                        errorMessage = error.message;
                    }
                    
                    navigationManager.showNotification(errorMessage, 'error');
                } finally {
                    navigationManager.hideLoading();
                }
            }

            searchAssignments(keyword) {
                const taskItems = document.querySelectorAll('.task-item');

                if (!keyword) {
                    // 검색어가 없으면 모든 과제 표시
                    taskItems.forEach(item => {
                        item.style.display = 'block';
                    });
                    return;
                }

                keyword = keyword.toLowerCase();

                // 검색어로 과제 필터링
                taskItems.forEach(item => {
                    const title = item.querySelector('.task-title').textContent.toLowerCase();
                    const meta = item.querySelector('.task-meta').textContent.toLowerCase();

                    if (title.includes(keyword) || meta.includes(keyword)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }

            filterAssignments(category) {
                const taskItems = document.querySelectorAll('.task-item');

                taskItems.forEach(item => {
                    const statusEl = item.querySelector('.task-status');
                    const statusClass = statusEl ? statusEl.className : '';

                    let shouldShow = false;

                    switch (category) {
                        case 'all':
                            shouldShow = true;
                            break;
                        case 'pending':
                            shouldShow = statusClass.includes('status-pending');
                            break;
                        case 'submitted':
                            shouldShow = statusClass.includes('status-submitted') || statusClass.includes('status-graded');
                            break;
                    }

                    item.style.display = shouldShow ? 'block' : 'none';
                });
            }

            showFeedbackModal() {
                const modal = document.getElementById('feedbackModal');
                const feedbackContent = document.getElementById('feedbackContent');

                if (!modal || !feedbackContent) return;

                let feedback = '';

                // 기본 피드백 생성
                if (this.currentSubmission && this.currentSubmission.feedback) {
                    feedback = this.currentSubmission.feedback;
                } else {
                    // 테스트 결과 기반 피드백 생성
                    if (this.testResults.length > 0) {
                        const passedCount = this.testResults.filter(result => result.passed).length;
                        const score = Math.round((passedCount / this.testResults.length) * 100);

                        if (score >= 90) {
                            feedback += '<p><strong>🎉 훌륭합니다!</strong> 모든 테스트 케이스를 성공적으로 통과했습니다.</p>';
                        } else if (score >= 70) {
                            feedback += '<p><strong>👍 좋은 시도입니다!</strong> 대부분의 테스트를 통과했습니다.</p>';
                        } else if (score >= 40) {
                            feedback += '<p><strong>🔍 개선이 필요합니다.</strong> 일부 테스트만 통과했습니다.</p>';
                        } else {
                            feedback += '<p><strong>❗ 다시 시도해보세요.</strong> 대부분의 테스트를 통과하지 못했습니다.</p>';
                        }

                        // 테스트 케이스 세부 결과
                        if (this.testResults.length > 0) {
                            feedback += '<p><strong>📊 테스트 케이스 결과:</strong></p>';
                            feedback += '<ul>';

                            for (let i = 0; i < this.testResults.length; i++) {
                                const result = this.testResults[i];
                                const icon = result.passed ? '✅' : '❌';

                                feedback += `<li>${icon} 테스트 ${i + 1} (입력: ${result.input}):</li>`;

                                if (!result.passed) {
                                    feedback += `<ul>`;
                                    feedback += `<li>기대 출력: ${result.expected}</li>`;
                                    feedback += `<li>실제 출력: ${result.output}</li>`;
                                    feedback += `</ul>`;
                                }
                            }

                            feedback += '</ul>';
                        }
                    } else {
                        feedback = '<p>아직 테스트를 실행하지 않았습니다. 테스트 버튼을 클릭하여 코드를 확인해보세요.</p>';
                    }
                }

                feedbackContent.innerHTML = feedback;
                modal.style.display = 'block';
            }
        }

        // 디버깅을 위한 전역 함수들
        window.debugAssignment = function() {
            console.log('Current assignment:', assignmentManager?.currentAssignment);
            console.log('Current workspace blocks:', assignmentManager?.workspace?.getTopBlocks().length);
            console.log('Auth token exists:', !!localStorage.getItem('authToken'));
            console.log('User info:', JSON.parse(localStorage.getItem('user') || '{}'));
        };

        window.testSubmission = async function() {
            if (assignmentManager) {
                console.log('Testing submission...');
                await assignmentManager.submitAssignment();
            }
        };

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM loaded, initializing...');
            
            // 네비게이션 매니저 초기화
            navigationManager = new NavigationManager();
            navigationManager.setupKeyboardShortcuts();

            // 과제 관리자 초기화
            assignmentManager = new AssignmentManager();
            
            console.log('Initialization complete');
        });

        // Blockly 웹페이지 크기 조정 시 자동 리사이징
        window.addEventListener('resize', function () {
            if (assignmentManager && assignmentManager.workspace) {
                Blockly.svgResize(assignmentManager.workspace);
            }
        });

        // 키보드 단축키
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'r':
                        e.preventDefault();
                        if (assignmentManager) {
                            assignmentManager.runCode();
                        }
                        break;
                    case 't':
                        e.preventDefault();
                        if (assignmentManager) {
                            assignmentManager.runTests();
                        }
                        break;
                    case 's':
                        e.preventDefault();
                        if (assignmentManager) {
                            assignmentManager.submitAssignment();
                        }
                        break;
                }
            }
        });

        // 페이지 이탈 시 확인
        window.addEventListener('beforeunload', function (e) {
            if (assignmentManager && assignmentManager.workspace && assignmentManager.workspace.getAllBlocks(false).length > 0) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>.Python.workspaceToCode(this.workspace);
                    } catch (e) {
                        code = '# 코드 생성 중 오류가 발생했습니다.\n# ' + e.message;
                    }
                } else {
                    // JavaScript 코드 생성
                    try {
                        code = Blockly