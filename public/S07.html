<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ë”©ìŠ¤íƒ€íŠ¸ - ê³¼ì œ ì¶œì œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #4285f4, #2a5298);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            height: 60px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-left: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .logo:hover {
            transform: scale(1.05);
        }
        .profile-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #4285f4;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .profile-icon:hover {
            transform: scale(1.1);
        }
        .sidebar {
            width: 200px;
            background-color: #ffffff;
            padding: 30px 0;
            position: fixed;
            left: 50px;
            top: 80px;
            bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .profile-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
        }
        .profile-image {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(66, 133, 244, 0.2);
        }
        .teacher-badge {
            background-color: #34a853;
            color: white;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            margin-top: 5px;
        }
        .menu-item {
            padding: 12px 20px;
            margin: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .menu-item.active {
            background-color: #4285f4;
            color: white;
            box-shadow: 0 4px 8px rgba(66, 133, 244, 0.2);
        }
        .menu-item:hover:not(.active) {
            background-color: #f1f8ff;
        }
        .content {
            margin-left: 280px;
            margin-top: 90px;
            padding: 20px;
            width: calc(100% - 320px);
        }
        .page-title {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #333333;
            border-bottom: 2px solid #4285f4;
            padding-bottom: 10px;
            display: inline-block;
        }
        
        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        .form-section {
            margin-bottom: 25px;
        }
        .form-section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333333;
            display: flex;
            align-items: center;
        }
        .form-section-title i {
            margin-right: 10px;
            font-size: 20px;
            color: #4285f4;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555555;
        }
        .form-group input[type="text"], 
        .form-group input[type="date"], 
        .form-group input[type="number"], 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #dddddd;
            border-radius: 5px;
            font-size: 14px;
            color: #333333;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        .form-group input[type="text"]:focus, 
        .form-group input[type="date"]:focus, 
        .form-group input[type="number"]:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            border-color: #4285f4;
            outline: none;
        }
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        .form-group select {
            background-color: white;
        }
        .input-hint {
            font-size: 12px;
            color: #888888;
            margin-top: 5px;
        }
        
        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
            margin-left: 10px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cccccc;
            transition: 0.4s;
            border-radius: 26px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #34a853;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        /* ê³¼ì œ ìœ í˜• ì„ íƒ ì¹´ë“œ */
        .assignment-types {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .type-card {
            flex: 1;
            background-color: white;
            border: 2px solid #dddddd;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        .type-card.selected {
            border-color: #4285f4;
            box-shadow: 0 6px 12px rgba(66, 133, 244, 0.15);
        }
        .type-icon {
            font-size: 36px;
            margin-bottom: 15px;
        }
        .type-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .type-description {
            font-size: 12px;
            color: #777777;
        }
        
        /* ì±„ì  ê¸°ì¤€ */
        .criteria-container {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .criteria-row {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
            padding: 8px;
            border-radius: 5px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .criteria-name {
            flex: 2;
        }
        .criteria-weight {
            flex: 1;
            display: flex;
            align-items: center;
        }
        .criteria-weight input {
            width: 60px;
            padding: 6px;
            border: 1px solid #dddddd;
            border-radius: 3px;
            text-align: center;
        }
        .criteria-weight span {
            margin-left: 5px;
        }
        .criteria-actions {
            width: 30px;
            text-align: center;
            cursor: pointer;
            color: #ff5252;
            font-weight: bold;
        }
        .add-criteria-btn {
            background-color: #f1f3f4;
            padding: 8px 12px;
            border-radius: 5px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            color: #555555;
            transition: all 0.3s ease;
            margin-top: 5px;
        }
        .add-criteria-btn i {
            margin-right: 8px;
            font-size: 18px;
            color: #4285f4;
        }
        .add-criteria-btn:hover {
            background-color: #e3f2fd;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .button-container {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        .btn {
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        .btn-primary {
            background-color: #4285f4;
            color: white;
            box-shadow: 0 4px 6px rgba(66, 133, 244, 0.25);
        }
        .btn-primary:hover {
            background-color: #3b78e7;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(66, 133, 244, 0.35);
        }
        .btn-secondary {
            background-color: #f1f3f4;
            color: #333333;
        }
        .btn-secondary:hover {
            background-color: #e4e6e7;
            transform: translateY(-2px);
        }
        
        /* í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì„¹ì…˜ */
        .test-cases {
            margin-top: 10px;
        }
        .test-case {
            background-color: white;
            border: 1px solid #eeeeee;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .test-case-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 500;
        }
        .test-case-remove {
            color: #ff5252;
            cursor: pointer;
            font-weight: bold;
        }
        .test-case-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .test-case-input, .test-case-output {
            flex: 1;
        }
        .test-case-input textarea, .test-case-output textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #dddddd;
            border-radius: 4px;
            font-size: 14px;
            min-height: 60px;
            resize: vertical;
            box-sizing: border-box;
        }
        .add-test-case-btn {
            display: inline-flex;
            align-items: center;
            background-color: #f1f3f4;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            color: #555555;
            transition: all 0.3s ease;
        }
        .add-test-case-btn:hover {
            background-color: #e3f2fd;
        }
        
        /* ì œì•½ì‚¬í•­ ì²´í¬ë°•ìŠ¤ */
        .constraints-container {
            margin-top: 10px;
        }
        .constraint-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .constraint-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
        }
        .constraint-label {
            flex: 1;
        }
        .constraint-value {
            width: 80px;
        }
        .constraint-value input {
            width: 100%;
            padding: 6px;
            border: 1px solid #dddddd;
            border-radius: 3px;
            text-align: center;
            box-sizing: border-box;
        }

        /* í†µí•© ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .navigation-notification {
            position: fixed;
            top: 100px;
            right: 30px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            font-family: Arial, sans-serif;
        }

        .error-notification {
            background: linear-gradient(135deg, #f44336, #d32f2f) !important;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4285f4, #34a853);
            width: 0%;
            transition: width 0.3s ease;
        }

        .validation-error {
            color: #f44336;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .form-group.error input,
        .form-group.error textarea,
        .form-group.error select {
            border-color: #f44336;
        }

        .form-group.error .validation-error {
            display: block;
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <div class="navbar">
            <div class="logo" id="logoLink">ğŸš€ ì½”ë”©ìŠ¤íƒ€íŠ¸</div>
            <div class="profile-icon" id="profileMenu">
                <span id="userInitial">U</span>
            </div>
        </div>
        
        <div class="sidebar">
            <div class="profile-section">
                <div class="profile-image">
                    <span id="userInitialSidebar">U</span>
                </div>
                <span id="userName">êµìˆ˜ë‹˜</span>
                <span class="teacher-badge">êµìˆ˜</span>
            </div>
            
            <div class="menu-item" id="dashboardMenu">ëŒ€ì‹œë³´ë“œ</div>
            <div class="menu-item active" id="createAssignmentMenu">ê³¼ì œ ì¶œì œ</div>
            <div class="menu-item" id="reviewSubmissionsMenu">ì œì¶œë¬¼ í‰ê°€</div>
            <div class="menu-item" id="studentAnalyticsMenu">í•™ìƒ ì„±ì·¨ë„</div>
            <div class="menu-item" id="managementMenu">í•™ìƒ ê´€ë¦¬</div>
        </div>
        
        <div class="content">
            <h1 class="page-title">ğŸ“‹ ê³¼ì œ ì¶œì œ</h1>
            
            <div class="form-container">
                <form id="createAssignmentForm">
                    <div class="form-section">
                        <div class="form-section-title">
                            <i>ğŸ“</i> ê¸°ë³¸ ì •ë³´
                        </div>
                        
                        <div class="form-group">
                            <label for="assignmentTitle">ê³¼ì œëª… *</label>
                            <input type="text" id="assignmentTitle" name="assignmentTitle" placeholder="ì˜ˆ: ë°˜ë³µë¬¸ìœ¼ë¡œ ì‚¬ê°í˜• ê·¸ë¦¬ê¸°" required>
                            <div class="validation-error">ê³¼ì œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="assignmentDescription">ê³¼ì œ ì„¤ëª… *</label>
                            <textarea id="assignmentDescription" name="assignmentDescription" placeholder="ê³¼ì œì— ëŒ€í•œ ìƒì„¸í•œ ì„¤ëª…ì„ ì‘ì„±í•˜ì„¸ìš”..." required></textarea>
                            <div class="validation-error">ê³¼ì œ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="problemStatement">ë¬¸ì œ ëª…ì„¸ *</label>
                            <textarea id="problemStatement" name="problemStatement" placeholder="í•™ìƒë“¤ì´ í•´ê²°í•´ì•¼ í•  êµ¬ì²´ì ì¸ ë¬¸ì œë¥¼ ì‘ì„±í•˜ì„¸ìš”..." required></textarea>
                            <div class="validation-error">ë¬¸ì œ ëª…ì„¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="difficultyLevel">ë‚œì´ë„ *</label>
                            <select id="difficultyLevel" name="difficultyLevel" required>
                                <option value="">ë‚œì´ë„ ì„ íƒ</option>
                                <option value="easy">ì´ˆê¸‰ (Easy)</option>
                                <option value="medium">ì¤‘ê¸‰ (Medium)</option>
                                <option value="hard">ê³ ê¸‰ (Hard)</option>
                            </select>
                            <div class="validation-error">ë‚œì´ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-section-title">
                            <i>ğŸ“…</i> ì¼ì • ì„¤ì •
                        </div>
                        
                        <div class="form-group">
                            <label for="dueDate">ë§ˆê°ì¼ *</label>
                            <input type="date" id="dueDate" name="dueDate" required>
                            <div class="validation-error">ë§ˆê°ì¼ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.</div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                ê³¼ì œ í™œì„±í™”
                                <label class="toggle-switch">
                                    <input type="checkbox" id="isActive" name="isActive" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                            <div class="input-hint">ë¹„í™œì„±í™” ì‹œ í•™ìƒë“¤ì—ê²Œ ê³¼ì œê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-section-title">
                            <i>ğŸ§ª</i> í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
                        </div>
                        
                        <div class="test-cases" id="testCasesContainer">
                            <div class="test-case">
                                <div class="test-case-header">
                                    <div>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ #1</div>
                                    <div class="test-case-remove">âœ•</div>
                                </div>
                                <div class="test-case-inputs">
                                    <div class="test-case-input">
                                        <label>ì…ë ¥ ë°ì´í„°</label>
                                        <textarea placeholder="í…ŒìŠ¤íŠ¸ ì…ë ¥ê°’ì„ ì…ë ¥í•˜ì„¸ìš”..." name="testInput"></textarea>
                                    </div>
                                    <div class="test-case-output">
                                        <label>ì˜ˆìƒ ì¶œë ¥</label>
                                        <textarea placeholder="ì˜ˆìƒ ì¶œë ¥ê°’ì„ ì…ë ¥í•˜ì„¸ìš”..." name="testOutput"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" name="testHidden" style="margin-right: 8px;">
                                        ìˆ¨ê²¨ì§„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (í•™ìƒì—ê²Œ ë³´ì´ì§€ ì•ŠìŒ)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="add-test-case-btn" id="addTestCaseBtn">
                            <i>+</i> í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ê°€
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-section-title">
                            <i>âš–ï¸</i> ì±„ì  ê¸°ì¤€
                        </div>
                        
                        <div class="form-group">
                            <label for="gradingCriteria">ì±„ì  ê¸°ì¤€ (JSON í˜•ì‹)</label>
                            <textarea id="gradingCriteria" name="gradingCriteria" placeholder='{"accuracy": 60, "code_quality": 25, "efficiency": 15}' style="min-height: 100px;"></textarea>
                            <div class="input-hint">ì±„ì  ê¸°ì¤€ì„ JSON í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: {"ì •í™•ì„±": 60, "ì½”ë“œí’ˆì§ˆ": 25, "íš¨ìœ¨ì„±": 15}</div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-section-title">
                            <i>ğŸ’¾</i> ì €ì¥ ë° ë¯¸ë¦¬ë³´ê¸°
                        </div>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        
                        <div class="button-container">
                            <button type="button" class="btn btn-secondary" id="saveDraftBtn">ì„ì‹œ ì €ì¥</button>
                            <button type="button" class="btn btn-secondary" id="previewBtn">ë¯¸ë¦¬ë³´ê¸°</button>
                            <button type="submit" class="btn btn-primary">ê³¼ì œ ìƒì„±</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // í†µí•© ë„¤ë¹„ê²Œì´ì…˜ ì‹œìŠ¤í…œ
        class NavigationManager {
            constructor() {
                this.currentUser = null;
                this.routes = {
                    'dashboard': '/dashboard',
                    'teacher-dashboard': '/teacher-dashboard',
                    'create-assignment': '/create-assignment',
                    'review-submissions': '/review-submissions',
                    'student-analytics': '/student-analytics',
                    'student-management': '/student-management',
                    'block-coding': '/block-coding',
                    'algorithm': '/algorithm',
                    'assignments': '/assignments',
                    'progress': '/progress',
                    'login': '/login'
                };
                
                this.init();
            }

            init() {
                if (!this.loadUserInfo()) return;
                this.updateNavigationUI();
                this.setupEventListeners();
            }

            loadUserInfo() {
                const token = localStorage.getItem('authToken');
                const userJSON = localStorage.getItem('user');

                if (!token || !userJSON) {
                    this.redirectToLogin();
                    return false;
                }

                try {
                    this.currentUser = JSON.parse(userJSON);
                    
                    // êµìˆ˜/ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
                    if (this.currentUser.role !== 'professor' && this.currentUser.role !== 'admin') {
                        this.showNotification('êµìˆ˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                        setTimeout(() => {
                            this.navigateTo('dashboard');
                        }, 1500);
                        return false;
                    }
                    
                    return true;
                } catch (error) {
                    console.error('ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', error);
                    this.clearAuthAndRedirect();
                    return false;
                }
            }

            updateNavigationUI() {
                if (!this.currentUser) return;

                // ì‚¬ìš©ì ì´ë¦„ ì—…ë°ì´íŠ¸
                const userNameEl = document.getElementById('userName');
                if (userNameEl) {
                    userNameEl.textContent = this.currentUser.name || 'êµìˆ˜ë‹˜';
                }

                // ì‚¬ìš©ì ì´ë‹ˆì…œ ì—…ë°ì´íŠ¸
                const initial = (this.currentUser.name || 'U').charAt(0).toUpperCase();
                const initialElements = document.querySelectorAll('#userInitial, #userInitialSidebar');
                initialElements.forEach(el => {
                    if (el) el.textContent = initial;
                });
            }

            setupEventListeners() {
                // ë¡œê³  í´ë¦­ ì´ë²¤íŠ¸
                const logoLink = document.getElementById('logoLink');
                if (logoLink) {
                    logoLink.addEventListener('click', () => {
                        this.navigateTo('teacher-dashboard');
                    });
                }

                // í”„ë¡œí•„ ë©”ë‰´ í´ë¦­ ì´ë²¤íŠ¸
                const profileMenu = document.getElementById('profileMenu');
                if (profileMenu) {
                    profileMenu.addEventListener('click', () => {
                        this.handleLogout();
                    });
                }

                // ì‚¬ì´ë“œë°” ë©”ë‰´ ì´ë²¤íŠ¸
                const menuMappings = {
                    'dashboardMenu': () => this.navigateTo('teacher-dashboard'),
                    'createAssignmentMenu': () => this.navigateTo('create-assignment'),
                    'reviewSubmissionsMenu': () => this.navigateTo('review-submissions'),
                    'studentAnalyticsMenu': () => this.navigateTo('student-analytics'),
                    'managementMenu': () => this.navigateTo('student-management')
                };

                Object.keys(menuMappings).forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('click', (e) => {
                            e.preventDefault();
                            menuMappings[id]();
                        });
                    }
                });
            }

            navigateTo(routeName) {
                if (this.routes[routeName]) {
                    this.showLoading();
                    
                    setTimeout(() => {
                        window.location.href = this.routes[routeName];
                    }, 300);
                } else {
                    console.error(`Route not found: ${routeName}`);
                }
            }

            redirectToLogin() {
                this.showNotification('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                setTimeout(() => {
                    window.location.href = this.routes.login;
                }, 1500);
            }

            clearAuthAndRedirect() {
                localStorage.clear();
                this.redirectToLogin();
            }

            handleLogout() {
                if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.showLoading();
                    
                    const token = localStorage.getItem('authToken');
                    fetch('/api/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + token,
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(() => {
                        localStorage.clear();
                        this.showNotification('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                        setTimeout(() => {
                            window.location.href = this.routes.login;
                        }, 1000);
                    })
                    .catch((error) => {
                        console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                        localStorage.clear();
                        window.location.href = this.routes.login;
                    })
                    .finally(() => {
                        this.hideLoading();
                    });
                }
            }

            showLoading() {
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (loadingOverlay) {
                    loadingOverlay.classList.add('active');
                }
            }

            hideLoading() {
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (loadingOverlay) {
                    loadingOverlay.classList.remove('active');
                }
            }

            showNotification(message, type = 'success') {
                const existingNotification = document.getElementById('navigationNotification');
                if (existingNotification) {
                    existingNotification.remove();
                }

                const notification = document.createElement('div');
                notification.id = 'navigationNotification';
                notification.className = `navigation-notification ${type === 'error' ? 'error-notification' : ''}`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);

                setTimeout(() => {
                    notification.style.transform = 'translateX(400px)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
        }

        // ê³¼ì œ ìƒì„± ê´€ë¦¬ì í´ë˜ìŠ¤
        class AssignmentCreator {
            constructor() {
                this.testCaseCount = 1;
                this.isDraft = false;
                this.currentData = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setDefaultValues();
                this.loadDraftIfExists();
            }

            setupEventListeners() {
                // í¼ ì œì¶œ ì´ë²¤íŠ¸
                document.getElementById('createAssignmentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleSubmit(false); // ì‹¤ì œ ìƒì„±
                });

                // ì„ì‹œ ì €ì¥ ë²„íŠ¼
                document.getElementById('saveDraftBtn').addEventListener('click', () => {
                    this.handleSubmit(true); // ì„ì‹œ ì €ì¥
                });

                // ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼
                document.getElementById('previewBtn').addEventListener('click', () => {
                    this.showPreview();
                });

                // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ê°€ ë²„íŠ¼
                document.getElementById('addTestCaseBtn').addEventListener('click', () => {
                    this.addTestCase();
                });

                // ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‚­ì œ ì´ë²¤íŠ¸
                this.setupTestCaseRemoveEvents();

                // ì‹¤ì‹œê°„ ìœ íš¨ì„± ê²€ì‚¬
                this.setupRealTimeValidation();

                // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 's':
                                e.preventDefault();
                                this.handleSubmit(true); // ì„ì‹œ ì €ì¥
                                break;
                            case 'Enter':
                                if (e.shiftKey) {
                                    e.preventDefault();
                                    this.handleSubmit(false); // ì‹¤ì œ ìƒì„±
                                }
                                break;
                        }
                    }
                });

                // í¼ ë³€ê²½ ê°ì§€ (ì§„í–‰ë¥  ì—…ë°ì´íŠ¸)
                const formElements = document.querySelectorAll('#createAssignmentForm input, #createAssignmentForm textarea, #createAssignmentForm select');
                formElements.forEach(element => {
                    element.addEventListener('input', () => {
                        this.updateProgress();
                    });
                });
            }

            setDefaultValues() {
                // ì˜¤ëŠ˜ë¶€í„° 2ì£¼ í›„ë¥¼ ê¸°ë³¸ ë§ˆê°ì¼ë¡œ ì„¤ì •
                const today = new Date();
                const dueDate = new Date();
                dueDate.setDate(today.getDate() + 14);
                document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];

                // ê¸°ë³¸ ì±„ì  ê¸°ì¤€ ì„¤ì •
                const defaultCriteria = {
                    "ì •í™•ì„±": 50,
                    "ì½”ë“œ êµ¬ì¡°": 30,
                    "íš¨ìœ¨ì„±": 20
                };
                document.getElementById('gradingCriteria').value = JSON.stringify(defaultCriteria, null, 2);

                this.updateProgress();
            }

            setupTestCaseRemoveEvents() {
                document.querySelectorAll('.test-case-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const testCase = e.target.closest('.test-case');
                        const container = document.getElementById('testCasesContainer');
                        
                        // ìµœì†Œ 1ê°œì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ëŠ” ìœ ì§€
                        if (container.querySelectorAll('.test-case').length > 1) {
                            testCase.remove();
                            this.updateTestCaseNumbers();
                            this.updateProgress();
                        } else {
                            navigationManager.showNotification('ìµœì†Œ 1ê°œì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                        }
                    });
                });
            }

            addTestCase() {
                this.testCaseCount++;
                const container = document.getElementById('testCasesContainer');
                
                const newTestCase = document.createElement('div');
                newTestCase.className = 'test-case';
                newTestCase.innerHTML = `
                    <div class="test-case-header">
                        <div>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ #${this.testCaseCount}</div>
                        <div class="test-case-remove">âœ•</div>
                    </div>
                    <div class="test-case-inputs">
                        <div class="test-case-input">
                            <label>ì…ë ¥ ë°ì´í„°</label>
                            <textarea placeholder="í…ŒìŠ¤íŠ¸ ì…ë ¥ê°’ì„ ì…ë ¥í•˜ì„¸ìš”..." name="testInput"></textarea>
                        </div>
                        <div class="test-case-output">
                            <label>ì˜ˆìƒ ì¶œë ¥</label>
                            <textarea placeholder="ì˜ˆìƒ ì¶œë ¥ê°’ì„ ì…ë ¥í•˜ì„¸ìš”..." name="testOutput"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="testHidden" style="margin-right: 8px;">
                            ìˆ¨ê²¨ì§„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (í•™ìƒì—ê²Œ ë³´ì´ì§€ ì•ŠìŒ)
                        </label>
                    </div>
                `;
                
                container.appendChild(newTestCase);
                
                // ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì˜ ì‚­ì œ ì´ë²¤íŠ¸ ì¶”ê°€
                newTestCase.querySelector('.test-case-remove').addEventListener('click', (e) => {
                    const testCase = e.target.closest('.test-case');
                    const container = document.getElementById('testCasesContainer');
                    
                    if (container.querySelectorAll('.test-case').length > 1) {
                        testCase.remove();
                        this.updateTestCaseNumbers();
                        this.updateProgress();
                    } else {
                        navigationManager.showNotification('ìµœì†Œ 1ê°œì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                    }
                });

                // ìƒˆë¡œìš´ ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                newTestCase.querySelectorAll('textarea').forEach(textarea => {
                    textarea.addEventListener('input', () => {
                        this.updateProgress();
                    });
                });

                this.updateProgress();
                navigationManager.showNotification('í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }

            updateTestCaseNumbers() {
                const testCases = document.querySelectorAll('.test-case');
                testCases.forEach((testCase, index) => {
                    testCase.querySelector('.test-case-header div:first-child').textContent = `í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ #${index + 1}`;
                });
                this.testCaseCount = testCases.length;
            }

            setupRealTimeValidation() {
                const requiredFields = [
                    { id: 'assignmentTitle', message: 'ê³¼ì œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' },
                    { id: 'assignmentDescription', message: 'ê³¼ì œ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' },
                    { id: 'problemStatement', message: 'ë¬¸ì œ ëª…ì„¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' },
                    { id: 'difficultyLevel', message: 'ë‚œì´ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.' },
                    { id: 'dueDate', message: 'ë§ˆê°ì¼ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.' }
                ];

                requiredFields.forEach(field => {
                    const element = document.getElementById(field.id);
                    const formGroup = element.closest('.form-group');
                    
                    element.addEventListener('blur', () => {
                        this.validateField(element, formGroup, field.message);
                    });

                    element.addEventListener('input', () => {
                        if (formGroup.classList.contains('error')) {
                            this.validateField(element, formGroup, field.message);
                        }
                    });
                });

                // ì±„ì  ê¸°ì¤€ JSON ìœ íš¨ì„± ê²€ì‚¬
                const gradingCriteria = document.getElementById('gradingCriteria');
                gradingCriteria.addEventListener('blur', () => {
                    this.validateGradingCriteria();
                });
            }

            validateField(element, formGroup, message) {
                const isValid = element.value.trim() !== '';
                
                if (isValid) {
                    formGroup.classList.remove('error');
                } else {
                    formGroup.classList.add('error');
                    formGroup.querySelector('.validation-error').textContent = message;
                }
                
                return isValid;
            }

            validateGradingCriteria() {
                const element = document.getElementById('gradingCriteria');
                const formGroup = element.closest('.form-group');
                
                try {
                    if (element.value.trim()) {
                        const criteria = JSON.parse(element.value);
                        if (typeof criteria === 'object' && criteria !== null) {
                            formGroup.classList.remove('error');
                            return true;
                        }
                    }
                } catch (e) {
                    formGroup.classList.add('error');
                    formGroup.querySelector('.validation-error').textContent = 'ì˜¬ë°”ë¥¸ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.';
                    return false;
                }
                
                return true; // ë¹ˆ ê°’ì€ í—ˆìš©
            }

            updateProgress() {
                const requiredFields = [
                    'assignmentTitle',
                    'assignmentDescription', 
                    'problemStatement',
                    'difficultyLevel',
                    'dueDate'
                ];

                let completedFields = 0;

                // í•„ìˆ˜ í•„ë“œ í™•ì¸
                requiredFields.forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element && element.value.trim()) {
                        completedFields++;
                    }
                });

                // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í™•ì¸
                const testCases = document.querySelectorAll('.test-case');
                let hasValidTestCase = false;
                testCases.forEach(testCase => {
                    const input = testCase.querySelector('textarea[name="testInput"]').value.trim();
                    const output = testCase.querySelector('textarea[name="testOutput"]').value.trim();
                    if (input && output) {
                        hasValidTestCase = true;
                    }
                });

                if (hasValidTestCase) {
                    completedFields++;
                }

                const totalFields = requiredFields.length + 1; // +1 for test cases
                const progress = Math.round((completedFields / totalFields) * 100);
                
                document.getElementById('progressFill').style.width = progress + '%';
            }

            collectFormData() {
                const formData = {
                    title: document.getElementById('assignmentTitle').value.trim(),
                    description: document.getElementById('assignmentDescription').value.trim(),
                    problem_statement: document.getElementById('problemStatement').value.trim(),
                    difficulty_level: document.getElementById('difficultyLevel').value,
                    due_date: document.getElementById('dueDate').value,
                    is_active: document.getElementById('isActive').checked,
                    grading_criteria: null,
                    test_cases: []
                };

                // ì±„ì  ê¸°ì¤€ ì²˜ë¦¬
                const gradingCriteriaText = document.getElementById('gradingCriteria').value.trim();
                if (gradingCriteriaText) {
                    try {
                        formData.grading_criteria = JSON.parse(gradingCriteriaText);
                    } catch (e) {
                        throw new Error('ì±„ì  ê¸°ì¤€ JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                }

                // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ìˆ˜ì§‘
                const testCases = document.querySelectorAll('.test-case');
                testCases.forEach((testCase, index) => {
                    const input = testCase.querySelector('textarea[name="testInput"]').value.trim();
                    const output = testCase.querySelector('textarea[name="testOutput"]').value.trim();
                    const isHidden = testCase.querySelector('input[name="testHidden"]').checked;

                    if (input && output) {
                        formData.test_cases.push({
                            input_data: input,
                            expected_output: output,
                            description: `í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ${index + 1}`,
                            is_hidden: isHidden
                        });
                    }
                });

                return formData;
            }

            validateFormData(data) {
                const errors = [];

                if (!data.title) errors.push('ê³¼ì œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                if (!data.description) errors.push('ê³¼ì œ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                if (!data.problem_statement) errors.push('ë¬¸ì œ ëª…ì„¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                if (!data.difficulty_level) errors.push('ë‚œì´ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                if (!data.due_date) errors.push('ë§ˆê°ì¼ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');

                // ë§ˆê°ì¼ ìœ íš¨ì„± ê²€ì‚¬
                const dueDate = new Date(data.due_date);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (dueDate < today) {
                    errors.push('ë§ˆê°ì¼ì€ ì˜¤ëŠ˜ ì´í›„ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.');
                }

                // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ê²€ì‚¬
                if (data.test_cases.length === 0) {
                    errors.push('ìµœì†Œ 1ê°œì˜ ìœ íš¨í•œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                }

                return errors;
            }

            async handleSubmit(isDraft = false) {
                try {
                    const data = this.collectFormData();
                    
                    if (!isDraft) {
                        const errors = this.validateFormData(data);
                        if (errors.length > 0) {
                            navigationManager.showNotification(errors[0], 'error');
                            return;
                        }
                    }

                    this.isDraft = isDraft;
                    
                    if (isDraft) {
                        await this.saveDraft(data);
                    } else {
                        await this.createAssignment(data);
                    }

                } catch (error) {
                    console.error('í¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    navigationManager.showNotification(error.message || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }

            async saveDraft(data) {
                try {
                    localStorage.setItem('assignmentDraft', JSON.stringify(data));
                    navigationManager.showNotification('ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (error) {
                    navigationManager.showNotification('ì„ì‹œ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }

            loadDraftIfExists() {
                try {
                    const draftData = localStorage.getItem('assignmentDraft');
                    if (draftData) {
                        const data = JSON.parse(draftData);
                        this.populateForm(data);
                        navigationManager.showNotification('ì„ì‹œ ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('ì„ì‹œ ì €ì¥ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            }

            populateForm(data) {
                if (data.title) document.getElementById('assignmentTitle').value = data.title;
                if (data.description) document.getElementById('assignmentDescription').value = data.description;
                if (data.problem_statement) document.getElementById('problemStatement').value = data.problem_statement;
                if (data.difficulty_level) document.getElementById('difficultyLevel').value = data.difficulty_level;
                if (data.due_date) document.getElementById('dueDate').value = data.due_date;
                if (typeof data.is_active !== 'undefined') document.getElementById('isActive').checked = data.is_active;
                
                if (data.grading_criteria) {
                    document.getElementById('gradingCriteria').value = JSON.stringify(data.grading_criteria, null, 2);
                }

                // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë³µì›
                if (data.test_cases && data.test_cases.length > 0) {
                    const container = document.getElementById('testCasesContainer');
                    container.innerHTML = ''; // ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì œê±°

                    data.test_cases.forEach((testCase, index) => {
                        this.addTestCaseWithData(testCase, index + 1);
                    });
                }

                this.updateProgress();
            }

            addTestCaseWithData(testCase, number) {
                const container = document.getElementById('testCasesContainer');
                
                const newTestCase = document.createElement('div');
                newTestCase.className = 'test-case';
                newTestCase.innerHTML = `
                    <div class="test-case-header">
                        <div>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ #${number}</div>
                        <div class="test-case-remove">âœ•</div>
                    </div>
                    <div class="test-case-inputs">
                        <div class="test-case-input">
                            <label>ì…ë ¥ ë°ì´í„°</label>
                            <textarea placeholder="í…ŒìŠ¤íŠ¸ ì…ë ¥ê°’ì„ ì…ë ¥í•˜ì„¸ìš”..." name="testInput">${testCase.input_data || ''}</textarea>
                        </div>
                        <div class="test-case-output">
                            <label>ì˜ˆìƒ ì¶œë ¥</label>
                            <textarea placeholder="ì˜ˆìƒ ì¶œë ¥ê°’ì„ ì…ë ¥í•˜ì„¸ìš”..." name="testOutput">${testCase.expected_output || ''}</textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="testHidden" style="margin-right: 8px;" ${testCase.is_hidden ? 'checked' : ''}>
                            ìˆ¨ê²¨ì§„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (í•™ìƒì—ê²Œ ë³´ì´ì§€ ì•ŠìŒ)
                        </label>
                    </div>
                `;
                
                container.appendChild(newTestCase);
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                newTestCase.querySelector('.test-case-remove').addEventListener('click', (e) => {
                    const testCase = e.target.closest('.test-case');
                    const container = document.getElementById('testCasesContainer');
                    
                    if (container.querySelectorAll('.test-case').length > 1) {
                        testCase.remove();
                        this.updateTestCaseNumbers();
                        this.updateProgress();
                    } else {
                        navigationManager.showNotification('ìµœì†Œ 1ê°œì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                    }
                });

                newTestCase.querySelectorAll('textarea').forEach(textarea => {
                    textarea.addEventListener('input', () => {
                        this.updateProgress();
                    });
                });

                this.testCaseCount = Math.max(this.testCaseCount, number);
            }

            async createAssignment(data) {
                navigationManager.showLoading();

                const token = localStorage.getItem('authToken');
                
                try {
                    const response = await fetch('/api/assignments', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + token
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        // ì„ì‹œ ì €ì¥ ë°ì´í„° ì‚­ì œ
                        localStorage.removeItem('assignmentDraft');
                        
                        navigationManager.showNotification('ê³¼ì œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        
                        // 2ì´ˆ í›„ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                        setTimeout(() => {
                            navigationManager.navigateTo('teacher-dashboard');
                        }, 2000);
                    } else {
                        throw new Error(result.message || 'ê³¼ì œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('ê³¼ì œ ìƒì„± ì˜¤ë¥˜:', error);
                    navigationManager.showNotification(
                        error.message || 'ê³¼ì œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 
                        'error'
                    );
                } finally {
                    navigationManager.hideLoading();
                }
            }

            showPreview() {
                try {
                    const data = this.collectFormData();
                    
                    // ë¯¸ë¦¬ë³´ê¸° ìœˆë„ìš° ìƒì„±
                    const previewWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
                    
                    const previewHTML = `
                        <!DOCTYPE html>
                        <html lang="ko">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <title>ê³¼ì œ ë¯¸ë¦¬ë³´ê¸°</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                                .header { background: #4285f4; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
                                .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
                                .test-case { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 4px; }
                                .difficulty { padding: 4px 8px; border-radius: 4px; color: white; font-size: 12px; }
                                .easy { background: #34a853; }
                                .medium { background: #fbbc05; }
                                .hard { background: #ea4335; }
                            </style>
                        </head>
                        <body>
                            <div class="header">
                                <h1>${data.title || 'ê³¼ì œ ì œëª©'}</h1>
                                <p>ë‚œì´ë„: <span class="difficulty ${data.difficulty_level}">${this.getDifficultyText(data.difficulty_level)}</span></p>
                                <p>ë§ˆê°ì¼: ${data.due_date || 'ë¯¸ì„¤ì •'}</p>
                            </div>
                            
                            <div class="section">
                                <h2>ğŸ“ ê³¼ì œ ì„¤ëª…</h2>
                                <p>${data.description || 'ì„¤ëª…ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'}</p>
                            </div>
                            
                            <div class="section">
                                <h2>ğŸ“‹ ë¬¸ì œ ëª…ì„¸</h2>
                                <p>${data.problem_statement || 'ë¬¸ì œ ëª…ì„¸ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'}</p>
                            </div>
                            
                            ${data.test_cases.length > 0 ? `
                            <div class="section">
                                <h2>ğŸ§ª í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</h2>
                                ${data.test_cases.map((testCase, index) => `
                                    <div class="test-case">
                                        <h4>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ${index + 1} ${testCase.is_hidden ? '(ìˆ¨ê¹€)' : ''}</h4>
                                        <p><strong>ì…ë ¥:</strong><br><pre>${testCase.input_data}</pre></p>
                                        <p><strong>ì˜ˆìƒ ì¶œë ¥:</strong><br><pre>${testCase.expected_output}</pre></p>
                                    </div>
                                `).join('')}
                            </div>
                            ` : ''}
                            
                            ${data.grading_criteria ? `
                            <div class="section">
                                <h2>âš–ï¸ ì±„ì  ê¸°ì¤€</h2>
                                <pre>${JSON.stringify(data.grading_criteria, null, 2)}</pre>
                            </div>
                            ` : ''}
                        </body>
                        </html>
                    `;
                    
                    previewWindow.document.write(previewHTML);
                    previewWindow.document.close();
                    
                } catch (error) {
                    navigationManager.showNotification('ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }

            getDifficultyText(level) {
                const levels = {
                    'easy': 'ì´ˆê¸‰ (Easy)',
                    'medium': 'ì¤‘ê¸‰ (Medium)', 
                    'hard': 'ê³ ê¸‰ (Hard)'
                };
                return levels[level] || level;
            }
        }

        // ë„¤ë¹„ê²Œì´ì…˜ ë§¤ë‹ˆì € ë° ê³¼ì œ ìƒì„±ì ì´ˆê¸°í™”
        let navigationManager;
        let assignmentCreator;

        document.addEventListener('DOMContentLoaded', function() {
            // ë„¤ë¹„ê²Œì´ì…˜ ë§¤ë‹ˆì € ì´ˆê¸°í™”
            navigationManager = new NavigationManager();
            
            // ê³¼ì œ ìƒì„±ì ì´ˆê¸°í™”
            assignmentCreator = new AssignmentCreator();
            
            // ë¡œë”© ì¢…ë£Œ
            if (navigationManager) {
                navigationManager.hideLoading();
            }
        });
    </script>
</body>
</html>